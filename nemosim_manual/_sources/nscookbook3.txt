.. _nscookbook3:

NEMOSIM - Cook book (3) 
=======================

The Orthogonal projection
-------------------------

Several examples used to illustrate NEMOSIM's feature have already introduced some of the map projections available. These include the last example in the previous section which used the orthogonal map projection. The following sections demonstrate the controls available to the user that affect the final view.

1. Using the Euler angles
-------------------------

The default view is a side-on view with the Greenwich Meridian on the vertical centre-line
and the Equator as the horizontal centreline. This view can be rotated in three planes
using three angular controls: ``-eu1  -eu2`` and ``-eu3``. Each takes a parameter in
degrees. Firstly, ``-eu1`` sets the east-west rotation. The following sequence shows the
result of changing values from 0. (the default) to 360. in steps of 30 degrees. For this
sequence ``-eu2`` and ``-eu3`` retain their defaults values of 0. :

.. autoimage:: example5a
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example5b
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example5c
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example5d
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example5e
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example5f
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example5g
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example5h
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example5i
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example5j
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example5k
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example5l
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example5m
    :scale-html: 25
    :scale-latex: 25

As a typical example, the third image is generated by::

  ./nemosim -f ./data/bathy_level.nc -o example5c.png -d Bathy_level \
  -nomask -spos 3 -cs ps.pal -bbg gray -ortho -show -eu1 60 -eu2 0 -eu3 0 \
  -grid 30. 15. -abg black -annotate 115 30 "eu1=60 eu2=0 eu3=0" -afs 15

Secondly, ``-eu2`` sets the north-south rotation. The following sequence shows the result
of changing values from -90. through 0. (the default) to 90. in steps of 30 degrees. For
this sequence ``-eu1`` and ``-eu3`` retain their defaults values of 0. :

.. autoimage:: example6a
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example6b
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example6c
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example6d
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example6e
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example6f
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example6g
    :scale-html: 25
    :scale-latex: 25


Thirdly, ``-eu3`` sets a left-right tilt. The following sequence shows the result
of changing values from -90. through 0. (the default) to 90. in steps of 30 degrees. For
this sequence ``-eu1`` and ``-eu2`` retain their defaults values of 0. :

.. autoimage:: example7a
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example7b
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example7c
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example7d
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example7e
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example7f
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example7g
    :scale-html: 25
    :scale-latex: 25

Thus ``-eu1`` and ``-eu2`` can be used to centre the view over a known geographical location. For example, given that the Kerguelen islands are situated at 69.5 degrees east and 49.25 degrees south, a view centred on the islands will be obtained with::

  ./nemosim -f ./data/bathy_level.nc -o example8a.png -d Bathy_level \
  -nomask -spos 3 -cs ps.pal -bbg gray -ortho -show -eu1 69.5 -eu2 -49.25 \
  -eu3 0 -grid 30. 15. -abg black -annotate 115 30 "eu1=69.5 eu2=-49.25 eu3=0" -afs 15

I.e.:

.. autoimage:: example8a
    :scale-html: 50
    :scale-latex: 50

And the third angle can be used to tilt around this point, e.g.::

  ./nemosim -f ./data/bathy_level.nc -o example8b.png -d Bathy_level \
  -nomask -spos 3 -cs ps.pal -bbg gray -ortho -show -eu1 69.5 -eu2 -49.25 \
  -eu3 60 -grid 30. 15. -abg black -annotate 115 30 "eu1=69.5 eu2=-49.25 eu3=60." -afs 15

.. autoimage:: example8b
    :scale-html: 50
    :scale-latex: 50



2. Pan and zoom options
-----------------------

By default the globe is sized to almost fit the minimum dimension of the image canvas. The
viewpoint can be raised or lowered from this setting by use of the ``-gsize`` option. This
option takes a single argument which is a non-dimensional scaling. The default view is
obtained with a value of 80. Lowering this value moves the viewpoint towards the globe
centre (an effective 'zoom-in'). Raising this value moves the viewpoint away (an effective
'zoom-out'). The following sequence of images uses the last example to illustrate this
with ``-gsize`` values of 10, 20, 40, 60, 80 (default), 100, 120, and 140 respectively:

.. autoimage:: example9a
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example9b
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example9c
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example9d
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example9e
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example9f
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example9g
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example9h
    :scale-html: 25
    :scale-latex: 25

Note the first few examples clearly verify that the Kerguelen Islands are at the centre of the
image.

The globe can also be moved off-centre using the ``-td`` (translation distance) and
``-ta`` (translation angle) options. The default value for both these parameters is
zero. The single argument to the ``-td`` option is a non-dimensional distance with a
useful range between 0 and 20. The single argument to the ``-ta`` option is an angle in
degrees measured from the horizontal. The following sequence of images varies the
translation distance from 5 to 20 with the default translation angle. The result moves
the globe to the right:

.. autoimage:: example9i
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example9j
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example9k
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example9l
    :scale-html: 25
    :scale-latex: 25

The translation angle can be used to move the globe along different radii. The following
sequence of images varies the translation angle between 45 degrees and 270 degrees with a
fixed translation distance of 15:

.. autoimage:: example9m
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example9n
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example9o
    :scale-html: 25
    :scale-latex: 25

.. autoimage:: example9p
    :scale-html: 25
    :scale-latex: 25

Finally, the offset distance and angle are most commonly used with a 'zoomed-in' image to
recover a sense of curvature. This is demonstrated in this final example which is a
variation of an earlier example used to illustrate the ``-gsize`` option with a value of
40:

.. autoimage:: example9q
    :scale-html: 50
    :scale-latex: 50


3. Adding grid-lines  
--------------------

One option has been used in all these examples which is yet to get a mention. This is the
``-grid`` option which overlays equally spaced lines of longitude and latitude. The option
takes two arguments which are the longitudional and latitudinal spacing (in degrees)
respectively.  These examples have used the recommended settings of 30. and 15. degrees
respectively. Obviously, smaller spacings may be more appropriate for zoomed in views. For
example, this variation of an earlier example with ``-grid 15. 10.``:

.. autoimage:: example10a
    :scale-html: 50
    :scale-latex: 50

The mechanism for drawing these lines is relatively crude, the lines are produced by
plotting regularly spaced dots along each requested line of constant longitude or
latitude. By default the dots are spaced 0.125 degrees apart. In many cases this provides
the appearance of continuous lines. However, the option: ``-gridstep`` can be used to fine
tune this by either:

 * using a finer angular step to draw better connected lines 
 * using a coarser angular step to reduce the visual significance of the grid lines

For example, specifying ``-gridstep 0.025 0.025`` produces continuous lines in the current
example:

.. autoimage:: example10b
    :scale-html: 50
    :scale-latex: 50

Whereas, specifying ``-gridstep 3.0 2.0`` produces a more subtle effect:

.. autoimage:: example10c
    :scale-html: 50
    :scale-latex: 50

4. Arc colour-scale options
---------------------------

It is worth noting that the default image size/aspect ratio results in some redundant
border areas for the whole globe images. A more compact image is obtained using a square
canvas but this can compress the colour-bar and is aesthetically less pleasing. An
alternative, 'arc' form of the colour-scale is provided for these cases. The colour-scale
can be positioned in any of the four quadrants using the values 5 through 8 of the
``-spos`` scale-position option. These cases are illustrated here:

.. autoimage:: example11c
    :scale-html: 50
    :scale-latex: 50

.. autoimage:: example11d
    :scale-html: 50
    :scale-latex: 50

.. autoimage:: example11a
    :scale-html: 50
    :scale-latex: 50

.. autoimage:: example11b
    :scale-html: 50
    :scale-latex: 50 

Note also that with all the non-rectangular map projections an alternative background
colour can be set for the 'white-space' around each map. Land areas within the map are set
by the ``-bg`` option; border areas are coloured according to the ``-bbg`` option and the
'non-mapped' areas of the image area are coloured according to the ``-abg`` option. The
default colour is a mid-gray. The four images above use both a white border and
alternative background; all previous examples in this section have used a black canvas
with gray borders. Because the arc scale will overlap part of the border area, the best
results are obtained when borders and blackground colours are the same. Dark backgrounds
will require changing the font colour used for annotations. For example:

.. autoimage:: example11e
    :scale-html: 50
    :scale-latex: 50

which was created using::

   ./nemosim -f ./data/bathy_level.nc -o example11e.png -d Bathy_level -nomask -cs ps.pal \
             -bbg black -ortho -show -eu1 69.5 -eu2 -49.25 -eu3 60 -grid 30. 15.          \
             -annotate 115 478 "eu1=69.5 eu2=-49.25 eu3=60. spos=6" -afs 15 -gsize 80     \
             -spos 6 -r 400 400 -bfg white -fg white -abg black

But choosing a dark background which is different to the land colour allows better determination of the map edges:

.. autoimage:: example11f
    :scale-html: 50
    :scale-latex: 50

which differs from the previous example only by::

   ./nemosim -as example11e.png -o example11f.png -bbg midnightblue -abg midnightblue
